!function(factory){if("object"==typeof module&&"object"==typeof module.exports){var v=factory(require,exports);void 0!==v&&(module.exports=v)}else"function"==typeof define&&define.amd&&define(["require","exports"],factory)}(function(require,exports){"use strict";function bytesOfSerialized(value){if(null==value||!0===value||!1===value)return 1;switch(typeof value){case"string":return 1+bytesOfUtf8(value)+1;case"number":return isNaN(value)?1:1+(value===Math.floor(value)?bytesOfInt(value):8);case"object":if(Array.isArray(value)){for(var bytes=1+bytesOfVql(value.length),i=0;i<value.length;i+=1)bytes+=bytesOfSerialized(value[i]);return bytes}if(value instanceof Uint8Array||value instanceof ArrayBuffer)return 1+bytesOfVql(value.byteLength)+value.byteLength;if(value instanceof Date)return 7;var bytes_1=1,count_1=0;return Object.keys(value).forEach(function(n){var v=value[n];void 0!==v&&"symbol"!=typeof v&&(count_1+=1,bytes_1+=bytesOfUtf8(n),bytes_1+=1,bytes_1+=bytesOfSerialized(v))}),bytes_1+=bytesOfVql(count_1)}}function writeSerialized(value,buffer,offset){if(null==value)return buffer[offset++]=0,1;if(!0===value)return buffer[offset++]=5,1;if(!1===value)return buffer[offset++]=6,1;var start=offset;switch(typeof value){case"string":buffer[offset++]=1,offset+=writeUtf8(value,buffer,offset),buffer[offset++]=0;break;case"number":if(isNaN(value))return buffer[offset++]=0,1;if(value===Math.floor(value)){var bytes=bytesOfInt(value);buffer[offset++]=16+2*(bytes-1)+(value<0?1:0),offset+=writeInt(value,buffer,offset)}else buffer[offset++]=8,offset+=writeFloat64(value,buffer,offset);break;case"object":if(Array.isArray(value)){buffer[offset++]=2,offset+=writeVql(value.length,buffer,offset);for(var i=0;i<value.length;i+=1)offset+=writeSerialized(value[i],buffer,offset)}else if(value instanceof Uint8Array){buffer[offset++]=4,offset+=writeVql(value.byteLength,buffer,offset);var view=value;for(i=0;i<view.length;i+=1)buffer[offset++]=view[i]}else if(value instanceof ArrayBuffer){buffer[offset++]=4,offset+=writeVql(value.byteLength,buffer,offset);for(view=new Uint8Array(value),i=0;i<view.length;i+=1)buffer[offset++]=view[i]}else if(value instanceof Date){var time=value.getTime();buffer[offset++]=0<=time?48:49,offset+=writeDate(value,buffer,offset)}else{buffer[offset++]=3;var count_2=0;Object.keys(value).forEach(function(n){var v=value[n];void 0!==v&&"symbol"!=typeof v&&(count_2+=1)}),offset+=writeVql(count_2,buffer,offset),Object.keys(value).sort().forEach(function(n){var v=value[n];void 0!==v&&"symbol"!=typeof v&&(offset+=writeUtf8(n,buffer,offset),buffer[offset++]=0,offset+=writeSerialized(v,buffer,offset))})}}return offset-start}function readSerialized(buffer,offset){var value,start=offset,byte=buffer[offset++];switch(byte){case 0:value=null;break;case 1:var length_1=stringLength(buffer,offset);value=readUtf8(buffer,offset,offset+length_1),offset+=length_1+1;break;case 2:if((offset+=(result=readVlq(buffer,offset)).bytes)>buffer.length)throw new Error("Data corrupted.");for(var count=result.value,array=new Array(count),i=0;i<count;i+=1){var result_1=readSerialized(buffer,offset);offset+=result_1.bytes,array[i]=result_1.value}value=array;break;case 3:if((offset+=(result=readVlq(buffer,offset)).bytes)>buffer.length)throw new Error("Data corrupted.");count=result.value;var object={};for(i=0;i<count;i+=1){var length_2=stringLength(buffer,offset),name_1=readUtf8(buffer,offset,offset+length_2),result_2=readSerialized(buffer,offset+=length_2+1);offset+=result_2.bytes,object[name_1]=result_2.value}value=object;break;case 4:var result;if((offset+=(result=readVlq(buffer,offset)).bytes)>buffer.length)throw new Error("Data corrupted.");count=result.value;var data=new Uint8Array(count);for(i=0;i<count;i+=1)data[i]=buffer[offset++];value=data.buffer;break;case 5:value=!0;break;case 6:value=!1;break;case 7:value=readFloat32(buffer,offset),offset+=4;break;case 8:value=readFloat64(buffer,offset),offset+=8;break;case 9:throw new Error("128-bit Float is not supported");case 48:case 49:value=readDate(buffer,offset,49==byte),offset+=6;break;default:if(!(16<=byte&&byte<=47))throw new Error("Unrecognized Flag "+byte.toString());if(!(byte<=30))throw new Error("Only integer with up to 53 bits is supported");var length_3=Math.floor((byte-16)/2)+1;value=readInt(buffer,offset,length_3,!!(1&byte)),offset+=length_3}return{value:value,bytes:offset-start}}function stringLength(buffer,offset){for(var start=offset;offset<buffer.length;){if(!buffer[offset])return offset-start;offset+=1}throw new Error("String is not terminiated with null.")}function readFloat32(buffer,offset){return float32Bytes[0]=buffer[offset],float32Bytes[1]=buffer[offset+1],float32Bytes[2]=buffer[offset+2],float32Bytes[3]=buffer[offset+3],float32Out[0]}function readFloat64(buffer,offset){return float64Bytes[0]=buffer[offset],float64Bytes[1]=buffer[offset+1],float64Bytes[2]=buffer[offset+2],float64Bytes[3]=buffer[offset+3],float64Bytes[4]=buffer[offset+4],float64Bytes[5]=buffer[offset+5],float64Bytes[6]=buffer[offset+6],float64Bytes[7]=buffer[offset+7],float64Out[0]}function writeFloat64(number,buffer,offset){return float64In[0]=number,buffer[offset]=float64Bytes[0],buffer[offset+1]=float64Bytes[1],buffer[offset+2]=float64Bytes[2],buffer[offset+3]=float64Bytes[3],buffer[offset+4]=float64Bytes[4],buffer[offset+5]=float64Bytes[5],buffer[offset+6]=float64Bytes[6],buffer[offset+7]=float64Bytes[7],8}Object.defineProperty(exports,"__esModule",{value:!0}),exports.serialize=function(value){var bytes=bytesOfSerialized(value),buffer=new Uint8Array(bytes);return writeSerialized(value,buffer,0),buffer.buffer},exports.bytesOfSerialized=bytesOfSerialized,exports.writeSerialized=writeSerialized,exports.deserialize=function(data){return readSerialized(data.buffer?data:new Uint8Array(data,0),0).value},exports.readSerialized=readSerialized,exports.readFloat32=readFloat32,exports.writeFloat32=function(number,buffer,offset){return float32In[0]=number,buffer[offset]=float32Bytes[0],buffer[offset+1]=float32Bytes[1],buffer[offset+2]=float32Bytes[2],buffer[offset+3]=float32Bytes[3],4},exports.readFloat64=readFloat64,exports.writeFloat64=writeFloat64;var float32In=new Float32Array(1),float32Bytes=new Uint8Array(float32In.buffer,0),float32Out=new Float32Array(float32In.buffer,0),float64In=new Float64Array(1),float64Bytes=new Uint8Array(float64In.buffer,0),float64Out=new Float64Array(float64In.buffer,0);function bytesOfInt(number){return(number=Math.floor(Math.abs(number)))<=255?1:number<=65535?2:number<=16777215?3:number<=4294967295?4:number<=0xffffffffff?5:number<=0xffffffffffff?6:7}function readInt(buffer,start,length,negative){for(var value=0,i=length-1;0<=i;i-=1){value=256*value+buffer[start+i]}return negative?-value:value}function writeInt(number,buffer,offset){for(var length=bytesOfInt(number=Math.floor(Math.abs(number))),i=0;i<length;i+=1)buffer[offset+i]=255&number,number=Math.floor(number/256);return length}function readDate(buffer,start,negative){var time=readInt(buffer,start,6,negative);return new Date(time)}function writeDate(date,buffer,offset){for(var number=Math.abs(date.getTime()),i=0;i<6;i+=1)buffer[offset+i]=255&number,number=Math.floor(number/256);return 6}function bytesOfVql(number){number=Math.floor(Math.abs(number)),number=Math.floor(number/128);for(var count=1;number;)number=Math.floor(number/128),count+=1;return count}function readVlq(buffer,start){for(var byte,value=0,offset=start;byte=buffer[offset],offset+=1,value=128*value+(127&byte),128&byte;);return{value:value,bytes:offset-start}}function writeVql(number,buffer,offset){for(var end=bytesOfVql(number=Math.floor(Math.abs(number)))-1,i=0;i<=end;i+=1)buffer[offset+i]=Math.floor(number/vqlDev[end-i])%128+128;return buffer[offset+end]^=128,end+1}exports.bytesOfInt=bytesOfInt,exports.readInt=readInt,exports.writeInt=writeInt,exports.readDate=readDate,exports.writeDate=writeDate,exports.bytesOfVql=bytesOfVql,exports.readVlq=readVlq,exports.writeVql=writeVql;var vqlDev=[1,128,16384,2097152,268435456,34359738368,4398046511104,562949953421312];function bytesOfUtf8(string){for(var len=0,c=0,i=0;i<string.length;++i)(c=string.charCodeAt(i))<128?len+=1:c<2048?len+=2:55296==(64512&c)&&56320==(64512&string.charCodeAt(i+1))?(++i,len+=4):len+=3;return len}function readUtf8(buffer,start,end){if(end-start<1)return"";for(var t,parts=null,chunk=[],i=0;start<end;)(t=buffer[start++])<128?chunk[i++]=t:191<t&&t<224?chunk[i++]=(31&t)<<6|63&buffer[start++]:239<t&&t<365?(t=((7&t)<<18|(63&buffer[start++])<<12|(63&buffer[start++])<<6|63&buffer[start++])-65536,chunk[i++]=55296+(t>>10),chunk[i++]=56320+(1023&t)):chunk[i++]=(15&t)<<12|(63&buffer[start++])<<6|63&buffer[start++],8191<i&&((parts||(parts=[])).push(String.fromCharCode.apply(String,chunk)),i=0);return parts?(i&&parts.push(String.fromCharCode.apply(String,chunk.slice(0,i))),parts.join("")):String.fromCharCode.apply(String,chunk.slice(0,i))}function writeUtf8(string,buffer,offset){for(var c1,c2,start=offset,i=0;i<string.length;++i)(c1=string.charCodeAt(i))<128?buffer[offset++]=c1:(c1<2048?buffer[offset++]=c1>>6|192:(55296==(64512&c1)&&56320==(64512&(c2=string.charCodeAt(i+1)))?(c1=65536+((1023&c1)<<10)+(1023&c2),++i,buffer[offset++]=c1>>18|240,buffer[offset++]=c1>>12&63|128):buffer[offset++]=c1>>12|224,buffer[offset++]=c1>>6&63|128),buffer[offset++]=63&c1|128);return offset-start}exports.bytesOfUtf8=bytesOfUtf8,exports.readUtf8=readUtf8,exports.writeUtf8=writeUtf8});